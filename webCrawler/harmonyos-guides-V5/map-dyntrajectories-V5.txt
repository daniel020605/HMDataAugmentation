动态轨迹
场景介绍
本章节将向您介绍如何在地图上绘制动态轨迹。
接口说明
绘制动态轨迹功能主要由TraceOverlayParams、addTraceOverlay、Marker和TraceOverlay提供，更多接口及使用方法请参见接口文档。
接口名
描述
TraceOverlayParams
动态轨迹参数。
addTraceOverlay(params: mapCommon.TraceOverlayParams, markers?: Array<Marker>): Promise<TraceOverlay>
绘制动态轨迹。
Marker
动态轨迹的一组标记。
TraceOverlay
动态轨迹，支持暂停和删除等功能。
开发步骤
 导入相关模块。import { mapCommon, map, MapComponent } from '@kit.MapKit';\nimport { AsyncCallback } from '@kit.BasicServicesKit'; 绘制动态轨迹。@Entry\n@Component\nstruct TranceOverLayDemo {\n  private TAG = \"OHMapSDK_TranceOverLayDemo\";\n  private mapOptions?: mapCommon.MapOptions;\n  private mapController?: map.MapComponentController;\n  private callback?: AsyncCallback<map.MapComponentController>;\n\n  aboutToAppear(): void {\n    // 初始化地图参数\n    this.mapOptions = {\n      position: {\n        target: {\n          latitude: 31.99227173519985,\n          longitude: 118.7622219990476\n        },\n        zoom: 16\n      },\n      scaleControlsEnabled: true\n    }\n\n    this.callback = async (err, mapController) => {\n      console.info(this.TAG, \"mapCallback err=\" + JSON.stringify(err) +\n        \"; mapController=\" + JSON.stringify(mapController));\n      if (!err) {\n        this.mapController = mapController;\n        // marker1的参数\n        let markerOptions1: mapCommon.MarkerOptions = {\n          position: {\n            latitude: 31.99227173519985,\n            longitude: 118.7622219990476\n          },\n          icon: $r(\"app.media.track_setting_sport_map_marker_22\"),\n          anchorU: 0.5,\n          anchorV: 1,\n          visible: true\n        };\n        // 新增marker1\n        let markerBoy1 = await this.mapController.addMarker(markerOptions1);\n        let boyImages1: map.PlayImageAnimation = new map.PlayImageAnimation();\n        boyImages1.setDuration(1000);\n        let resoureArray: Array<Resource> = new Array();\n        // 需要替换您自己的资源图片，存放在resources/base/media目录下\n        resoureArray.push($r(\"app.media.side_0\"));\n        resoureArray.push($r(\"app.media.side_1\"));\n        resoureArray.push($r(\"app.media.side_2\"));\n        resoureArray.push($r(\"app.media.side_3\"));\n        resoureArray.push($r(\"app.media.side_4\"));\n        resoureArray.push($r(\"app.media.side_5\"));\n        resoureArray.push($r(\"app.media.side_6\"));\n        resoureArray.push($r(\"app.media.side_7\"));\n        resoureArray.push($r(\"app.media.side_8\"));\n        resoureArray.push($r(\"app.media.side_9\"));\n        resoureArray.push($r(\"app.media.side_10\"));\n        resoureArray.push($r(\"app.media.side_11\"));\n        resoureArray.push($r(\"app.media.side_12\"));\n        resoureArray.push($r(\"app.media.side_13\"));\n        resoureArray.push($r(\"app.media.side_14\"));\n        resoureArray.push($r(\"app.media.side_15\"));\n        resoureArray.push($r(\"app.media.side_16\"));\n        resoureArray.push($r(\"app.media.side_17\"));\n        resoureArray.push($r(\"app.media.side_18\"));\n        resoureArray.push($r(\"app.media.side_19\"));\n        resoureArray.push($r(\"app.media.side_20\"));\n        await boyImages1.addImages(resoureArray);\n        boyImages1.setRepeatCount(-1);\n\n        // marker1添加动画\n        markerBoy1.setAnimation(boyImages1);\n        markerBoy1.startAnimation();\n\n        // marker2的参数\n        let markerOptions2: mapCommon.MarkerOptions = {\n          position: {\n            latitude: 31.99227173519985,\n            longitude: 118.7622219990476\n          },\n          icon: $r(\"app.media.track_setting_sport_map_marker_22\"),\n          anchorU: 0.5,\n          anchorV: 1,\n          visible: false\n        };\n        // 新增marker2\n        let markerBoy2 = await this.mapController.addMarker(markerOptions2)\n        let boyImages2: map.PlayImageAnimation = new map.PlayImageAnimation();\n        boyImages2.setDuration(1000);\n        let resoureArray2: Array<Resource> = new Array();\n        // 需要替换您自己的资源图片，存放在resources/base/media目录下\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_000\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_001\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_002\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_003\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_004\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_005\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_006\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_007\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_008\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_009\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_010\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_011\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_012\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_013\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_014\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_015\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_016\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_017\"));\n        resoureArray2.push($r(\"app.media.behavior_front_cycling_boy_018\"));\n        await boyImages2.addImages(resoureArray2);\n        boyImages2.setRepeatCount(-1);\n        // marker2添加动画\n        markerBoy2.setAnimation(boyImages2);\n        markerBoy2.startAnimation();\n\n        let points: Array<mapCommon.LatLng> = new Array();\n        points.push({ latitude: 31.99685233070878, longitude: 118.75846023442728 });\n        points.push({ latitude: 31.99671325810786, longitude: 118.75846738985165 });\n        points.push({ latitude: 31.99659191076709, longitude: 118.7585347621686 });\n        points.push({ latitude: 31.99648202537233, longitude: 118.7586266510386 });\n        points.push({ latitude: 31.99637707201552, longitude: 118.75872004590596 });\n        points.push({ latitude: 31.996278207010903, longitude: 118.75880449946251 });\n        points.push({ latitude: 31.996187481969695, longitude: 118.7588781960278 });\n        points.push({ latitude: 31.996092248919354, longitude: 118.75895330554488 });\n        points.push({ latitude: 31.995962740450565, longitude: 118.75904721407304 });\n        points.push({ latitude: 31.995792921394, longitude: 118.75916904998051 });\n        points.push({ latitude: 31.995601885713416, longitude: 118.7593235241019 });\n        points.push({ latitude: 31.995398221178277, longitude: 118.75949998588176 });\n        points.push({ latitude: 31.995185902197715, longitude: 118.7596871082939 });\n        points.push({ latitude: 31.994983473052656, longitude: 118.75987334062296 });\n        points.push({ latitude: 31.99482433699269, longitude: 118.76002095184032 });\n        points.push({ latitude: 31.994709073721708, longitude: 118.76012902920532 });\n        points.push({ latitude: 31.99460732100702, longitude: 118.76023892576234 });\n        points.push({ latitude: 31.99449284962087, longitude: 118.7603694232856 });\n        points.push({ latitude: 31.99435358179254, longitude: 118.76053622438056 });\n        points.push({ latitude: 31.99420771148339, longitude: 118.76072790126692 });\n        points.push({ latitude: 31.994075194901523, longitude: 118.7609100960977 });\n        points.push({ latitude: 31.993952686158877, longitude: 118.7610741329013 });\n        points.push({ latitude: 31.993840180644217, longitude: 118.7612193418965 });\n        points.push({ latitude: 31.993733787150244, longitude: 118.76135383115654 });\n        points.push({ latitude: 31.993617206525155, longitude: 118.76150529647698 });\n\n        // 动态轨迹的入参\n        let tranceOptions: mapCommon.TraceOverlayParams = {\n          // 轨迹点\n          points: points,\n          // 轨迹的动画时长\n          animationDuration: 5000,\n          // 相机是否跟随动画移动\n          isMapMoving: true,\n          // 轨迹的颜色\n          color: 0xAAFFAA00,\n          // 轨迹的宽度\n          width: 20,\n          // 轨迹的动画回调（回调轨迹点的index）\n          animationCallback: (pointIndex) => {\n            // 换成骑行\n            if (pointIndex === 10) {\n              markerBoy1.setVisible(false);\n              markerBoy2.setVisible(true);\n            }\n          }\n        }\n        let markers: Array<map.Marker> = new Array();\n        markers.push(markerBoy1, markerBoy2);\n        // 新增轨迹点动画\n        let traceOverlay = await this.mapController.addTraceOverlay(tranceOptions, markers);\n      }\n    }\n  }\n\n  build() {\n    Stack() {\n      Column() {\n        MapComponent({\n          mapOptions: this.mapOptions,\n          mapCallback: this.callback,\n        }).width('100%').height('100%');\n      }.width('100%')\n    }.height('100%')\n  }\n} 
