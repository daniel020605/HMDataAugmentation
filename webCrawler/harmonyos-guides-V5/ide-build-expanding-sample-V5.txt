API使用示例
示例：在工程级hvigorfile.ts文件中分别注册工程级与模块级任务。
// 工程级hvigorfile.ts文件\nimport { hvigor, HvigorNode, HvigorPlugin } from '@ohos/hvigor';\nimport { appTasks, OhosHapContext, OhosPluginId, Target } from '@ohos/hvigor-ohos-plugin';\n\n// 实现自定义插件\nexport function customPlugin(): HvigorPlugin {\n  return {\n    pluginId: 'customPlugin',\n    context() {\n      return {\n        data: 'customPlugin xxx'\n      };\n    },\n    async apply(currentNode: HvigorNode): Promise<void> {\n      hvigor.nodesEvaluated(async () => {\n        // 注册模块级任务\n        hapTask(currentNode);\n      });\n    }\n  };\n}\nfunction hapTask(currentNode: HvigorNode) {\n  // 等待全部节点加载完成之后获取子节点信息\n  currentNode.subNodes((node: HvigorNode) => {\n    // 获取hap模块上下文信息\n    const hapContext = node.getContext(OhosPluginId.OHOS_HAP_PLUGIN) as OhosHapContext;\n    const moduleName = hapContext?.getModuleName();\n    hapContext?.targets((target: Target) => {\n      const targetName = target.getTargetName();\n      const outputPath = target.getBuildTargetOutputPath();\n      // 禁用任务\n      node.getTaskByName(`${target.getTargetName()}@SignHap`)?.setEnable(false);\n      node.registerTask({\n        // 任务名称\n        name: `${targetName}@onlineSignHap`,\n        // 任务执行逻辑主体函数\n        run() {\n          console.log('module Task');\n        },\n        // 配置前置任务依赖\n        dependencies: [`${targetName}@PackageHap`],\n        // 配置任务的后置任务依赖\n        postDependencies: ['assembleHap']\n      });\n    });\n  });\n}\nexport default {\n  system: appTasks,  /* Built-in plugin of Hvigor. It cannot be modified. */\n  plugins:[customPlugin()]         /* Custom plugin to extend the functionality of Hvigor. */\n};
