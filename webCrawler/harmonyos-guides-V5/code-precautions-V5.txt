代码开发注意事项
区分升级场景和克隆场景
开发者需要区分升级场景和克隆场景时，可以重写BackupExtensionAbility中的onRestoreEx方法，通过restoreInfo预留字段进行场景区分。onRestoreEx方法详细使用指导请参考：BackupExtensionAbility API参考。
import { BackupExtensionAbility, BundleVersion } from '@kit.CoreFileKit';\n\nconst TAG = `BackupExtensionAbility`;\n\ninterface ErrorInfo {\n  type: string,\n  errorCode: number,\n  errorInfo: string\n}\n\ninterface DetailInfo {\n    type: string,\n    detail: string\n}\n\nexport default class EntryBackupAbility extends BackupExtensionAbility {\n  async onBackup() {\n    console.log(TAG, 'onBackup ok');\n  }\n\n  async onRestoreEx(bundleVersion: BundleVersion, restoreInfo: string): Promise<string> {\n    console.log(TAG, `onRestoreEx ok ${JSON.stringify(bundleVersion)}`);\n    let errorInfo: ErrorInfo = {\n      type: \"ErrorInfo\",\n      errorCode: 0,\n      errorInfo: \"app diy error info\"\n    }\n    if (bundleVersion.name.startsWith(\"0.0.0.0\")){\n      // 在此处实现终端设备从HarmonyOS 4.x到HarmonyOS NEXT的应用数据处理。\n      // 涉及异步操作请进行同步等待\n      console.log(TAG, `HarmonyOS to HarmonyOS NEXT scenario`);\n\n      // 如果升级场景与克隆场景没有差异化数据处理诉求，此处可以忽略。\n      if (this.IsOtaScenario(restoreInfo)) {\n        // 在此处实现终端设备从HarmonyOS 4.x到HarmonyOS NEXT/5.0.x升级场景的特有数据处理。无特殊要求，此处可以忽略。\n        console.log(TAG, `Ota Scenario`)\n      } else {\n        // 在此处实现终端设备从HarmonyOS 4.x到HarmonyOS NEXT/5.0.x克隆场景的特有数据处理。无特殊要求，此处可以忽略。\n        console.log(TAG, `Clone Scenario`)\n      }\n    } else {\n      // 在此处实现从HarmonyOS NEXT/5.0.x设备迁移到HarmonyOS NEXT/5.0.x设备后，应用数据的处理。无特殊要求，可以空实现。\n      // 涉及异步操作请进行同步等待\n      console.log(TAG, `Other scenario`);\n    }\n    return JSON.stringify(errorInfo);\n  }\n\n  /**\n   * 判断是否是升级场景\n   * @param restoreInfo 预留字段，应用恢复过程中需要的扩展参数\n   * @returns 升级场景返回true，否则返回false\n   */\n  IsOtaScenario(restoreInfo: string): boolean {\n    let details:Array<DetailInfo> = JSON.parse(restoreInfo);\n    return details.some((detailInfo) => {\n      //设备从HarmonyOS 4.x升级到HarmonyOS NEXT/5.0.x场景判断条件\n      return detailInfo.type == 'isSameDevice' && detailInfo.detail == 'true';\n    });\n  }\n}
